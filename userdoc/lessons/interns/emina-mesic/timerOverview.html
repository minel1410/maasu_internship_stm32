<!DOCTYPE html>
<html class="writer-html5" lang="en" data-content_root="../../../../">
<head>
  <meta charset="utf-8" /><meta name="viewport" content="width=device-width, initial-scale=1" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>4.1.3.6. Timers in STM32 &mdash; Maasu Internship 4 1 documentation</title>
      <link rel="stylesheet" type="text/css" href="../../../../_static/pygments.css?v=80d5e7a1" />
      <link rel="stylesheet" type="text/css" href="../../../../_static/css/theme.css?v=19f00094" />
      <link rel="stylesheet" type="text/css" href="../../../../_static/sphinx-data-viewer/jsonview.bundle.css?v=f6ef2277" />
      <link rel="stylesheet" type="text/css" href="../../../../_static/sphinx-needs/libs/html/datatables.min.css?v=4b4fd840" />
      <link rel="stylesheet" type="text/css" href="../../../../_static/sphinx-needs/common.css?v=bd9ab754" />
      <link rel="stylesheet" type="text/css" href="../../../../_static/sphinx-needs/layouts.css?v=448c382f" />
      <link rel="stylesheet" type="text/css" href="../../../../_static/sphinx-needs/styles.css?v=6c8eb985" />
      <link rel="stylesheet" type="text/css" href="../../../../_static/sphinx-needs/modern.css?v=ffa536d2" />

  
  <!--[if lt IE 9]>
    <script src="../../../../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script src="../../../../_static/jquery.js?v=5d32c60e"></script>
        <script src="../../../../_static/_sphinx_javascript_frameworks_compat.js?v=2cd50e6c"></script>
        <script src="../../../../_static/documentation_options.js?v=29a6c3e3"></script>
        <script src="../../../../_static/doctools.js?v=888ff710"></script>
        <script src="../../../../_static/sphinx_highlight.js?v=dc90522c"></script>
        <script src="../../../../_static/sphinx-data-viewer/jsonview.bundle.js?v=18cd53c5"></script>
        <script src="../../../../_static/sphinx-data-viewer/jsonview_loader.js?v=f7ff7e7d"></script>
        <script src="../../../../_static/sphinx-needs/libs/html/datatables.min.js?v=8a4aee21"></script>
        <script src="../../../../_static/sphinx-needs/libs/html/datatables_loader.js?v=a2cae175"></script>
        <script src="../../../../_static/sphinx-needs/libs/html/sphinx_needs_collapse.js?v=f783d6a5"></script>
    <script src="../../../../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../../../../genindex.html" />
    <link rel="search" title="Search" href="../../../../search.html" />
    <link rel="next" title="4.1.4. Lessons by Lamija Fatić" href="../lamija-fatic/lessons.html" />
    <link rel="prev" title="4.1.3.5. USART Overview" href="USARToverview.html" />
<link href="../../../../_static/style.css" rel="stylesheet" type="text/css">

</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="../../../../index.html" class="icon icon-home">
            Maasu Internship 4
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">Contents:</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../../../introduction/introduction.html">1. Introduction</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../fundamentals/fundamentals.html">2. Fundamentals</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../environment_setup/environment_setup.html">3. Development Environment Setup</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="../../lessons.html">4. Lessons</a><ul class="current">
<li class="toctree-l2 current"><a class="reference internal" href="../lessons.html">4.1. Lessons written by each intern</a><ul class="current">
<li class="toctree-l3"><a class="reference internal" href="../adna-njuhovic/lessons.html">4.1.1. Lessons by Adna Njuhović</a></li>
<li class="toctree-l3"><a class="reference internal" href="../demir-hasicic/lessons.html">4.1.2. Lessons by Demir Hasičić</a></li>
<li class="toctree-l3 current"><a class="reference internal" href="lessons.html">4.1.3. Lessons by Emina Mešić</a><ul class="current">
<li class="toctree-l4"><a class="reference internal" href="vmodel.html">4.1.3.1. V-Model Overview</a></li>
<li class="toctree-l4"><a class="reference internal" href="stm32overview.html">4.1.3.2. STM32F411 Overview</a></li>
<li class="toctree-l4"><a class="reference internal" href="GPIOoverview.html">4.1.3.3. GPIO Overview</a></li>
<li class="toctree-l4"><a class="reference internal" href="ClockInitOverview.html">4.1.3.4. Clock Initialization Overview</a></li>
<li class="toctree-l4"><a class="reference internal" href="USARToverview.html">4.1.3.5. USART Overview</a></li>
<li class="toctree-l4 current"><a class="current reference internal" href="#">4.1.3.6. Timers in STM32</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../lamija-fatic/lessons.html">4.1.4. Lessons by Lamija Fatić</a></li>
<li class="toctree-l3"><a class="reference internal" href="../muhibija-kavazovic/lessons.html">4.1.5. Lessons by Muhibija Kavazović</a></li>
<li class="toctree-l3"><a class="reference internal" href="../semin-murtic/lessons.html">4.1.6. Lessons by Semin Murtić</a></li>
<li class="toctree-l3"><a class="reference internal" href="../tarik-sinanovic/lessons.html">4.1.7. Lessons by Tarik Sinanović</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../../requirements/requirements.html">5. Requirements</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../faqs/faqs.html">6. Frequently Asked Questions</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../glossary/glossary.html">7. Glossary</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../resources/resources.html">8. Resources</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../../../index.html">Maasu Internship 4</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../../../../index.html" class="icon icon-home" aria-label="Home"></a></li>
          <li class="breadcrumb-item"><a href="../../lessons.html"><span class="section-number">4. </span>Lessons</a></li>
          <li class="breadcrumb-item"><a href="../lessons.html"><span class="section-number">4.1. </span>Lessons written by each intern</a></li>
          <li class="breadcrumb-item"><a href="lessons.html"><span class="section-number">4.1.3. </span>Lessons by Emina Mešić</a></li>
      <li class="breadcrumb-item active"><span class="section-number">4.1.3.6. </span>Timers in STM32</li>
      <li class="wy-breadcrumbs-aside">
            <a href="../../../../_sources/userdoc/lessons/interns/emina-mesic/timerOverview.rst.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="timers-in-stm32">
<h1><span class="section-number">4.1.3.6. </span>Timers in STM32<a class="headerlink" href="#timers-in-stm32" title="Link to this heading"></a></h1>
<p>Timers in the STM32F411 microcontroller are versatile components used for precise time-related tasks. They help with measuring elapsed time, generating pulses, and controlling time-based processes. The STM32F411 has several timers (e.g., TIM1, TIM2, TIM3), and each can be configured for different uses, such as PWM signal generation, managing interrupts, or creating precise delays.</p>
<section id="key-timer-functions-and-applications">
<h2><span class="section-number">4.1.3.6.1. </span>Key Timer Functions and Applications<a class="headerlink" href="#key-timer-functions-and-applications" title="Link to this heading"></a></h2>
<dl class="simple">
<dt>Timers in STM32F411 are primarily used for:</dt><dd><ol class="arabic simple">
<li><p><strong>Measuring Time</strong>: Timers can count up or down based on a clock signal, either from the system clock or an external source. This is useful for tracking time intervals and generating events based on elapsed time</p></li>
<li><p><strong>Pulse Generation</strong>: By configuring a timer, you can generate pulses at specific frequencies and durations, which is crucial for tasks like producing PWM signals</p></li>
<li><p><strong>Interrupt Handling</strong>: Timers can be set to trigger an interrupt when they reach a specific value, allowing the microcontroller to respond immediately to time-based events</p></li>
</ol>
</dd>
<dt><strong>Applications</strong>:</dt><dd><ul class="simple">
<li><p>Generating fixed time intervals for delays</p></li>
<li><p>Handling tasks that need precise timing (e.g., motor control or LED dimming)</p></li>
</ul>
</dd>
</dl>
</section>
<section id="introduction-to-pwm-pulse-width-modulation">
<h2><span class="section-number">4.1.3.6.2. </span>Introduction to PWM (Pulse Width Modulation)<a class="headerlink" href="#introduction-to-pwm-pulse-width-modulation" title="Link to this heading"></a></h2>
<p><strong>Pulse Width Modulation (PWM)</strong> is a technique used to generate variable output signals by adjusting the duty cycle, which is the percentage of time the signal is high within one cycle. In STM32F411, PWM signals are created using timers, which control the output on specific GPIO pins.</p>
<dl class="simple">
<dt><strong>Key PWM Parameters</strong>:</dt><dd><ul class="simple">
<li><p><strong>Duty Cycle</strong>: The percentage of time the signal remains high during one cycle. For instance, a 50% duty cycle means the signal is high for half of its period</p></li>
<li><p><strong>Frequency</strong>: Defines how many times the PWM signal cycles from high to low per second. This is determined by the timer’s period settings</p></li>
</ul>
</dd>
</dl>
<p><strong>Common Uses</strong>:</p>
<blockquote>
<div><ul class="simple">
<li><p><strong>Motor Speed Control</strong>: Changing the duty cycle adjusts the power delivered to the motor, influencing its speed</p></li>
<li><p><strong>LED Brightness Control</strong>: The duty cycle affects the brightness of the LED, with a higher duty cycle resulting in a brighter output</p></li>
<li><p><strong>Audio Signal Generation</strong>: PWM can be used to produce audio signals with different tones and frequencies</p></li>
</ul>
</div></blockquote>
<p>Setting Up PWM in STM32F411
In this example, we will configure TIM3 to generate a PWM signal with a frequency of 20 kHz and a duty cycle of 25%. Below are the step-by-step configurations, including the required register settings and calculations.</p>
<p>1. <strong>Enabling the Timer Clock</strong>
Enable the clock for TIM3 by setting the RCC_APB1ENR_TIM3EN bit. This timer operates on the APB1 bus, which has a clock frequency of 50 MHz.</p>
<p>2. <strong>Configuring GPIO Pins</strong>
Set PB0 to Alternate Function 2 (AF2) to use TIM3 Channel 3. This pin needs to be configured as an output in alternate function mode to enable PWM output.</p>
<ol class="arabic simple" start="3">
<li><p><strong>Configuring PWM Mode</strong></p></li>
</ol>
<blockquote>
<div><ol class="arabic simple">
<li><p>Clear the bits in the CCMR2 register for Channel 3.</p></li>
<li><p>Enable the OC3PE bit to activate the preload register, ensuring stable PWM signals and preventing glitches when adjusting the duty cycle.</p></li>
</ol>
</div></blockquote>
<p>4.  <strong>Calculating the PWM Frequency</strong>
The PWM frequency is determined by the timer period, which depends on the clock frequency and the values of the prescaler and Auto-Reload Register (ARR). The formula to calculate the period is:</p>
<blockquote>
<div><p><em>Period = Timer Clock / Frequency</em></p>
</div></blockquote>
<dl class="simple">
<dt>For a 20 kHz signal with a 50 MHz clock:</dt><dd><p><em>Period = 50 000 000 / 20,000 = 2500</em></p>
</dd>
</dl>
<p>Since the calculated period (2500) is within the 16-bit range (0-65535), we can set the prescaler to 0. Thus:
- <strong>PSC = 0</strong>
- <strong>ARR = Period – 1 = 2499</strong></p>
<p>5.  <strong>Calculating the Duty Cycle</strong>
The duty cycle determines how long the signal remains high during each PWM period. The value is set using the Capture/Compare Register (CCR). The formula for the CCR value is:</p>
<blockquote>
<div><p><em>CCR = (25 * (ARR + 1)) / 100 = (25 * 2500) / 100 = 625</em></p>
</div></blockquote>
<p>Write this value to the CCR3 register for Channel 3.</p>
<p>6. <strong>Enabling PWM Output</strong>
Finally, start the timer by setting the TIM_CR1_CEN bit in the control register.</p>
</section>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="USARToverview.html" class="btn btn-neutral float-left" title="4.1.3.5. USART Overview" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="../lamija-fatic/lessons.html" class="btn btn-neutral float-right" title="4.1.4. Lessons by Lamija Fatić" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2024, Maasu BH d.o.o..</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>