<!DOCTYPE html>
<html class="writer-html5" lang="en" data-content_root="../../../../">
<head>
  <meta charset="utf-8" /><meta name="viewport" content="width=device-width, initial-scale=1" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>4.1.4.6. STM32F411 Timer &mdash; Maasu Internship 4 1 documentation</title>
      <link rel="stylesheet" type="text/css" href="../../../../_static/pygments.css?v=80d5e7a1" />
      <link rel="stylesheet" type="text/css" href="../../../../_static/css/theme.css?v=19f00094" />
      <link rel="stylesheet" type="text/css" href="../../../../_static/sphinx-data-viewer/jsonview.bundle.css?v=f6ef2277" />
      <link rel="stylesheet" type="text/css" href="../../../../_static/sphinx-needs/libs/html/datatables.min.css?v=4b4fd840" />
      <link rel="stylesheet" type="text/css" href="../../../../_static/sphinx-needs/common.css?v=bd9ab754" />
      <link rel="stylesheet" type="text/css" href="../../../../_static/sphinx-needs/layouts.css?v=448c382f" />
      <link rel="stylesheet" type="text/css" href="../../../../_static/sphinx-needs/styles.css?v=6c8eb985" />
      <link rel="stylesheet" type="text/css" href="../../../../_static/sphinx-needs/modern.css?v=ffa536d2" />

  
  <!--[if lt IE 9]>
    <script src="../../../../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script src="../../../../_static/jquery.js?v=5d32c60e"></script>
        <script src="../../../../_static/_sphinx_javascript_frameworks_compat.js?v=2cd50e6c"></script>
        <script src="../../../../_static/documentation_options.js?v=29a6c3e3"></script>
        <script src="../../../../_static/doctools.js?v=888ff710"></script>
        <script src="../../../../_static/sphinx_highlight.js?v=dc90522c"></script>
        <script src="../../../../_static/sphinx-data-viewer/jsonview.bundle.js?v=18cd53c5"></script>
        <script src="../../../../_static/sphinx-data-viewer/jsonview_loader.js?v=f7ff7e7d"></script>
        <script src="../../../../_static/sphinx-needs/libs/html/datatables.min.js?v=8a4aee21"></script>
        <script src="../../../../_static/sphinx-needs/libs/html/datatables_loader.js?v=a2cae175"></script>
        <script src="../../../../_static/sphinx-needs/libs/html/sphinx_needs_collapse.js?v=f783d6a5"></script>
    <script src="../../../../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../../../../genindex.html" />
    <link rel="search" title="Search" href="../../../../search.html" />
    <link rel="next" title="4.1.5. Lessons by Muhibija Kavazović" href="../muhibija-kavazovic/lessons.html" />
    <link rel="prev" title="4.1.4.5. Universal Synchronous Asynchronous Receiver Transmitter (USART)" href="USART.html" />
<link href="../../../../_static/style.css" rel="stylesheet" type="text/css">

</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="../../../../index.html" class="icon icon-home">
            Maasu Internship 4
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">Contents:</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../../../introduction/introduction.html">1. Introduction</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../fundamentals/fundamentals.html">2. Fundamentals</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../environment_setup/environment_setup.html">3. Development Environment Setup</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="../../lessons.html">4. Lessons</a><ul class="current">
<li class="toctree-l2 current"><a class="reference internal" href="../lessons.html">4.1. Lessons written by each intern</a><ul class="current">
<li class="toctree-l3"><a class="reference internal" href="../adna-njuhovic/lessons.html">4.1.1. Lessons by Adna Njuhović</a></li>
<li class="toctree-l3"><a class="reference internal" href="../demir-hasicic/lessons.html">4.1.2. Lessons by Demir Hasičić</a></li>
<li class="toctree-l3"><a class="reference internal" href="../emina-mesic/lessons.html">4.1.3. Lessons by Emina Mešić</a></li>
<li class="toctree-l3 current"><a class="reference internal" href="lessons.html">4.1.4. Lessons by Lamija Fatić</a><ul class="current">
<li class="toctree-l4"><a class="reference internal" href="v-model.html">4.1.4.1. V-Model in Embedded Engineering</a></li>
<li class="toctree-l4"><a class="reference internal" href="STM32F411MCU.html">4.1.4.2. SMT32F411 Overview</a></li>
<li class="toctree-l4"><a class="reference internal" href="GPIO.html">4.1.4.3. GPIO for STM32F411 MCU</a></li>
<li class="toctree-l4"><a class="reference internal" href="Clock.html">4.1.4.4. STM32 Clock Initialization</a></li>
<li class="toctree-l4"><a class="reference internal" href="USART.html">4.1.4.5. Universal Synchronous Asynchronous Receiver Transmitter (USART)</a></li>
<li class="toctree-l4 current"><a class="current reference internal" href="#">4.1.4.6. STM32F411 Timer</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../muhibija-kavazovic/lessons.html">4.1.5. Lessons by Muhibija Kavazović</a></li>
<li class="toctree-l3"><a class="reference internal" href="../semin-murtic/lessons.html">4.1.6. Lessons by Semin Murtić</a></li>
<li class="toctree-l3"><a class="reference internal" href="../tarik-sinanovic/lessons.html">4.1.7. Lessons by Tarik Sinanović</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../../requirements/requirements.html">5. Requirements</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../faqs/faqs.html">6. Frequently Asked Questions</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../glossary/glossary.html">7. Glossary</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../resources/resources.html">8. Resources</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../../../index.html">Maasu Internship 4</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../../../../index.html" class="icon icon-home" aria-label="Home"></a></li>
          <li class="breadcrumb-item"><a href="../../lessons.html"><span class="section-number">4. </span>Lessons</a></li>
          <li class="breadcrumb-item"><a href="../lessons.html"><span class="section-number">4.1. </span>Lessons written by each intern</a></li>
          <li class="breadcrumb-item"><a href="lessons.html"><span class="section-number">4.1.4. </span>Lessons by Lamija Fatić</a></li>
      <li class="breadcrumb-item active"><span class="section-number">4.1.4.6. </span>STM32F411 Timer</li>
      <li class="wy-breadcrumbs-aside">
            <a href="../../../../_sources/userdoc/lessons/interns/lamija-fatic/timer.rst.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="stm32f411-timer">
<h1><span class="section-number">4.1.4.6. </span>STM32F411 Timer<a class="headerlink" href="#stm32f411-timer" title="Link to this heading"></a></h1>
<section id="introduction">
<h2><span class="section-number">4.1.4.6.1. </span>Introduction<a class="headerlink" href="#introduction" title="Link to this heading"></a></h2>
<dl class="simple">
<dt>Timers on the STM32F411 microcontroller are essential components used to handle a variety of time-related tasks, such as precise time measurement, signal generation, and control of processes requiring defined time intervals.</dt><dd><p>The STM32F411 features several timers (like TIM1, TIM2, TIM3, etc.), which can be configured for a wide range of applications. These include generating Pulse Width Modulation (PWM) signals for motor control, creating accurate delays, and triggering interrupts based on specific timing events.
Additionally, timers support advanced functions like input capture and output compare, making them versatile tools in embedded systems.</p>
</dd>
</dl>
</section>
<section id="functionalities-of-stm32-timer">
<h2><span class="section-number">4.1.4.6.2. </span>Functionalities of STM32 Timer<a class="headerlink" href="#functionalities-of-stm32-timer" title="Link to this heading"></a></h2>
<p><strong>Functionalities:</strong></p>
<p>Time Measurement: The timer on the STM32F411 can be configured to count time intervals accurately, using either the system clock or an external signal as a reference. This allows for precise timing operations, such as generating time-based interrupts to execute specific tasks or processes at set intervals.
Pulse Generation: Timers can produce pulses with a defined period and frequency. This is particularly useful for applications requiring PWM (Pulse Width Modulation) signals, commonly used for motor control or LED brightness adjustments.
Interrupts: Timers are capable of triggering interrupts when the counter reaches a specified value, enabling timely execution of interrupt service routines for handling events or processes. Additionally, timers support advanced modes like input capture (for measuring signal timing) and output compare (for event synchronization), making them flexible for various real-time applications.</p>
<p><strong>Advantages:</strong></p>
<ol class="arabic simple">
<li><p><strong>Time Measurement:</strong> Ensures accurate timing for periodic interrupts and time-based task management.</p></li>
<li><p><strong>Pulse Generation:</strong> Provides precise control over pulse signals, critical for motor speed regulation or LED dimming.</p></li>
<li><p><strong>Interrupt Handling:</strong> Facilitates responsive handling of tasks and synchronization using advanced modes like input capture and output compare.</p></li>
</ol>
</section>
<section id="pulse-width-modulation-pwm">
<h2><span class="section-number">4.1.4.6.3. </span>Pulse Width Modulation (PWM)<a class="headerlink" href="#pulse-width-modulation-pwm" title="Link to this heading"></a></h2>
<p>PWM is a technique used to create variable output signals by adjusting the duty cycle, which is the percentage of time the signal remains active in a given period. On the STM32F411, PWM generation is managed by timers that control signal output on GPIO pins. This method is essential for controlling motors, adjusting LED brightness, or any application requiring precise signal modulation.
The timers in STM32F411 can be configured to produce PWM signals with different frequencies and duty cycles, offering flexibility for diverse real-time applications.
<strong>Parameters:</strong></p>
<ol class="arabic simple">
<li><p><strong>Duty Cycle:</strong> Percentage of the period the signal remains high.
- Example: A 50% duty cycle results in equal high/low intervals.</p></li>
<li><p><strong>Frequency:</strong> Determines how many cycles occur per second, controlled by the timer’s period settings.</p></li>
</ol>
<p><strong>Use Cases:</strong></p>
<p>Motor Speed Control: PWM signals are used to control the speed of DC motors effectively. By adjusting the duty cycle, the average voltage applied to the motor is varied, thus increasing or decreasing the motor speed. A higher duty cycle results in a faster motor, while a lower duty cycle reduces the speed.
LED Brightness Control: PWM can modulate LED brightness by altering the duty cycle. A higher duty cycle makes the LED brighter, whereas a lower duty cycle dims the LED.
Audio Signals: PWM can generate audio signals of varying frequencies, useful for creating tones and beeps in devices.
Servo Motor Positioning: PWM is also essential in positioning servo motors. By setting the pulse width precisely, the servo motor’s angle can be controlled accurately, crucial for applications in robotics and automated systems.</p>
</section>
<section id="process-of-initialization">
<h2><span class="section-number">4.1.4.6.4. </span>Process of Initialization<a class="headerlink" href="#process-of-initialization" title="Link to this heading"></a></h2>
<p><strong>Main Steps:</strong></p>
<blockquote>
<div><p><strong>1.Enabling the Clock for the TIMER: Before configuring the TIMER, ensure that the appropriate clock signal is enabled using the RCC registers. This step powers the timer and makes it ready for configuration.</strong>
<strong>2.Configuring the Corresponding GPIO Pins: Set the GPIO pins in the alternate function mode to handle PWM output signals. These pins should be mapped correctly to the timer channels.</strong>
<strong>3.Setting the Frequency: Configure the timer’s prescaler and auto-reload register to set the desired frequency of the PWM signal, ensuring precision based on your application’s requirements.</strong>
<strong>4.Adjusting the Duty Cycle: Define the pulse width by setting the timer’s capture/compare register. The duty cycle controls the “active” time of the signal, essential for applications like motor speed or LED brightness control.</strong>
<strong>5.Configuring PWM Mode: Set the timer in PWM mode, which defines how the timer generates the PWM signal. Make sure to select the correct mode and enable the timer to start generating the signal.</strong></p>
</div></blockquote>
</section>
<section id="configuration">
<h2><span class="section-number">4.1.4.6.5. </span>Configuration<a class="headerlink" href="#configuration" title="Link to this heading"></a></h2>
<p>Enabling a Clock for a Timer:</p>
<p>To enable a timer on the STM32 microcontroller, it’s essential to activate the corresponding clock source. Each timer has a unique bit in the RCC (Reset and Clock Control) register that must be set to provide power and start its operation. Setting the appropriate bit in the RCC register allows the timer to receive power and become operational.
For example, enabling TIM1 requires setting the RCC_APB2ENR_TIM1EN bit in the APB2ENR register, while TIM2 requires setting the RCC_APB1ENR_TIM2EN bit in the APB1ENR register. This ensures that the desired timer receives the necessary clock signal to function effectively.
<strong>Configuration of GPIO Pins:</strong></p>
<p>To ensure proper configuration based on the selected TIMER, it is crucial to enable the correct GPIO pins and assign appropriate alternate functions to these pins. This step allows the TIMER’s output or input signals to function correctly. For reference, the STM32F411 datasheet or the corresponding documentation on the official GitHub repository provides a comprehensive overview of pin mapping and alternate functions, detailing which pins should be configured for specific TIMER operations.
<strong>Configuration of PWM Mode:</strong></p>
<ul class="simple">
<li><p><strong>Capture/Compare Mode Register (CCMR):</strong>
- Configures timer channels for PWM generation.
- <strong>TIM_CCMR1:</strong> Controls channels 1 and 2.
- <strong>TIM_CCMR2:</strong> Controls channels 3 and 4.</p></li>
<li><p><strong>Capture/Compare Enable Register (CCER):</strong>
- Enables output for channels.
- <strong>TIM_CCER_CC1E:</strong> Enables channel 1 output.
- <strong>TIM_CCER_CC2E:</strong> Enables channel 2 output.</p></li>
</ul>
<p><strong>Duty Cycle:</strong></p>
<p>The <strong>duty cycle</strong> determines the high-state duration as a percentage of the total period. It is calculated using:</p>
<img alt="userdoc/lessons/interns/lamija-fatic/path_to_image" src="userdoc/lessons/interns/lamija-fatic/path_to_image" />
<p>Where <strong>ARR</strong> is the auto-reload register. Load the calculated value into the capture/compare register (CCR).</p>
</section>
<section id="ca-and-ea-modes">
<h2><span class="section-number">4.1.4.6.6. </span>CA and EA Modes<a class="headerlink" href="#ca-and-ea-modes" title="Link to this heading"></a></h2>
<p><strong>Center-Aligned Mode:</strong>
The center-aligned mode allows for a symmetric PWM signal because the timer counts both up and down within the PWM period. This configuration creates a waveform symmetric around the center of the period. This setup is ideal for generating balanced signals and can be adjusted using appropriate control bits in the timer register.
<strong>Edge-Aligned Mode:</strong>
In the edge-aligned mode, the timer counts from zero up to the ARR value and then resets, creating waveforms with transitions at the edges of the period. This is the default mode for most PWM configurations and can also be set using specific control bits in the timer register.</p>
</section>
<section id="example">
<h2><span class="section-number">4.1.4.6.7. </span>Example<a class="headerlink" href="#example" title="Link to this heading"></a></h2>
<p><strong>Generating a PWM Signal (20 kHz, 25% Duty Cycle) Using TIM3</strong></p>
<ol class="arabic">
<li><p><strong>Enable the Clock for TIM3:</strong>
- Set <cite>RCC_APB1ENR_TIM3EN</cite> in the RCC register.</p></li>
<li><p><strong>Configure GPIO Pins:</strong>
- Set PA6 (TIM3 Channel 1) in alternate function mode (AF).
- Configure the pin in <cite>GPIOx_AFR</cite>.</p></li>
<li><p><strong>Set Frequency:</strong>
- Use the formula for PWM frequency to calculate prescaler (PSC) and auto-reload register (ARR).</p>
<img alt="userdoc/lessons/interns/lamija-fatic/path_to_frequency_formula" src="userdoc/lessons/interns/lamija-fatic/path_to_frequency_formula" />
<p>Example Values:
- <strong>PSC:</strong> 83
- <strong>ARR:</strong> 49</p>
</li>
<li><p><strong>Set Duty Cycle:</strong>
- Calculate the CCR value for 25% duty cycle.</p>
<img alt="userdoc/lessons/interns/lamija-fatic/path_to_duty_cycle_formula" src="userdoc/lessons/interns/lamija-fatic/path_to_duty_cycle_formula" />
<p>Example Value:
- <strong>CCR:</strong> 12</p>
</li>
<li><p><strong>Configure TIM3 in PWM Mode:</strong>
- Set PWM mode in <cite>TIM3_CCMR1</cite>.
- Enable the channel in <cite>TIM3_CCER</cite>.
- Start the timer by setting <cite>TIM3_CR1</cite>.</p></li>
</ol>
<p>This configuration generates a PWM signal with a 20 kHz frequency and a 25% duty cycle on TIM3 Channel 1.</p>
</section>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="USART.html" class="btn btn-neutral float-left" title="4.1.4.5. Universal Synchronous Asynchronous Receiver Transmitter (USART)" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="../muhibija-kavazovic/lessons.html" class="btn btn-neutral float-right" title="4.1.5. Lessons by Muhibija Kavazović" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2024, Maasu BH d.o.o..</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>