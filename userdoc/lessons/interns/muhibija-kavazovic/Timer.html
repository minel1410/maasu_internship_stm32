<!DOCTYPE html>
<html class="writer-html5" lang="en" data-content_root="../../../../">
<head>
  <meta charset="utf-8" /><meta name="viewport" content="width=device-width, initial-scale=1" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>4.1.6.6. Timer on STM32F411 &mdash; Maasu Internship 4 1 documentation</title>
      <link rel="stylesheet" type="text/css" href="../../../../_static/pygments.css?v=80d5e7a1" />
      <link rel="stylesheet" type="text/css" href="../../../../_static/css/theme.css?v=19f00094" />
      <link rel="stylesheet" type="text/css" href="../../../../_static/sphinx-data-viewer/jsonview.bundle.css?v=f6ef2277" />
      <link rel="stylesheet" type="text/css" href="../../../../_static/sphinx-needs/libs/html/datatables.min.css?v=4b4fd840" />
      <link rel="stylesheet" type="text/css" href="../../../../_static/sphinx-needs/common.css?v=bd9ab754" />
      <link rel="stylesheet" type="text/css" href="../../../../_static/sphinx-needs/layouts.css?v=448c382f" />
      <link rel="stylesheet" type="text/css" href="../../../../_static/sphinx-needs/styles.css?v=6c8eb985" />
      <link rel="stylesheet" type="text/css" href="../../../../_static/sphinx-needs/modern.css?v=ffa536d2" />

  
  <!--[if lt IE 9]>
    <script src="../../../../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script src="../../../../_static/jquery.js?v=5d32c60e"></script>
        <script src="../../../../_static/_sphinx_javascript_frameworks_compat.js?v=2cd50e6c"></script>
        <script src="../../../../_static/documentation_options.js?v=29a6c3e3"></script>
        <script src="../../../../_static/doctools.js?v=888ff710"></script>
        <script src="../../../../_static/sphinx_highlight.js?v=dc90522c"></script>
        <script src="../../../../_static/sphinx-data-viewer/jsonview.bundle.js?v=18cd53c5"></script>
        <script src="../../../../_static/sphinx-data-viewer/jsonview_loader.js?v=f7ff7e7d"></script>
        <script src="../../../../_static/sphinx-needs/libs/html/datatables.min.js?v=8a4aee21"></script>
        <script src="../../../../_static/sphinx-needs/libs/html/datatables_loader.js?v=a2cae175"></script>
        <script src="../../../../_static/sphinx-needs/libs/html/sphinx_needs_collapse.js?v=f783d6a5"></script>
        <script async="async" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <script src="../../../../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../../../../genindex.html" />
    <link rel="search" title="Search" href="../../../../search.html" />
    <link rel="next" title="4.1.7. Lessons by Semin Murtić" href="../semin-murtic/lessons.html" />
    <link rel="prev" title="4.1.6.5. USART on STM32F411" href="USART.html" />
<link href="../../../../_static/style.css" rel="stylesheet" type="text/css">

</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="../../../../index.html" class="icon icon-home">
            Maasu Internship 4
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">Contents:</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../../../introduction/introduction.html">1. Introduction</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../fundamentals/fundamentals.html">2. Fundamentals</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../environment_setup/environment_setup.html">3. Development Environment Setup</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="../../lessons.html">4. Lessons</a><ul class="current">
<li class="toctree-l2 current"><a class="reference internal" href="../lessons.html">4.1. Lessons written by each intern</a><ul class="current">
<li class="toctree-l3"><a class="reference internal" href="../adna-njuhovic/lessons.html">4.1.1. Lessons by Adna Njuhović</a></li>
<li class="toctree-l3"><a class="reference internal" href="../anesa-lakovic/lessons.html">4.1.2. Lessons by Anesa Laković</a></li>
<li class="toctree-l3"><a class="reference internal" href="../demir-hasicic/lessons.html">4.1.3. Lessons by Demir Hasičić</a></li>
<li class="toctree-l3"><a class="reference internal" href="../emina-mesic/lessons.html">4.1.4. Lessons by Emina Mešić</a></li>
<li class="toctree-l3"><a class="reference internal" href="../lamija-fatic/lessons.html">4.1.5. Lessons by Lamija Fatić</a></li>
<li class="toctree-l3 current"><a class="reference internal" href="lessons.html">4.1.6. Lessons by Muhibija Kavazović</a><ul class="current">
<li class="toctree-l4"><a class="reference internal" href="vmodel.html">4.1.6.1. V-Model Overview</a></li>
<li class="toctree-l4"><a class="reference internal" href="stm32f411.html">4.1.6.2. STM32F411 Overview</a></li>
<li class="toctree-l4"><a class="reference internal" href="Clock.html">4.1.6.3. Clock Initialization on STM32F411</a></li>
<li class="toctree-l4"><a class="reference internal" href="GPIO.html">4.1.6.4. GPIO on STM32F411</a></li>
<li class="toctree-l4"><a class="reference internal" href="USART.html">4.1.6.5. USART on STM32F411</a></li>
<li class="toctree-l4 current"><a class="current reference internal" href="#">4.1.6.6. Timer on STM32F411</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../semin-murtic/lessons.html">4.1.7. Lessons by Semin Murtić</a></li>
<li class="toctree-l3"><a class="reference internal" href="../tarik-sinanovic/lessons.html">4.1.8. Lessons by Tarik Sinanović</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../../requirements/requirements.html">5. Requirements</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../faqs/faqs.html">6. Frequently Asked Questions</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../glossary/glossary.html">7. Glossary</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../resources/resources.html">8. Resources</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../../../index.html">Maasu Internship 4</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../../../../index.html" class="icon icon-home" aria-label="Home"></a></li>
          <li class="breadcrumb-item"><a href="../../lessons.html"><span class="section-number">4. </span>Lessons</a></li>
          <li class="breadcrumb-item"><a href="../lessons.html"><span class="section-number">4.1. </span>Lessons written by each intern</a></li>
          <li class="breadcrumb-item"><a href="lessons.html"><span class="section-number">4.1.6. </span>Lessons by Muhibija Kavazović</a></li>
      <li class="breadcrumb-item active"><span class="section-number">4.1.6.6. </span>Timer on STM32F411</li>
      <li class="wy-breadcrumbs-aside">
            <a href="../../../../_sources/userdoc/lessons/interns/muhibija-kavazovic/Timer.rst.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="timer-on-stm32f411">
<h1><span class="section-number">4.1.6.6. </span>Timer on STM32F411<a class="headerlink" href="#timer-on-stm32f411" title="Link to this heading"></a></h1>
<section id="overview-of-timer-functionality">
<h2><span class="section-number">4.1.6.6.1. </span>Overview of Timer Functionality<a class="headerlink" href="#overview-of-timer-functionality" title="Link to this heading"></a></h2>
<p>Timers in STM32F411 are versatile peripherals used for:</p>
<ul class="simple">
<li><p>Generating precise delays</p></li>
<li><p>Measuring input signal characteristics</p></li>
<li><p>Producing PWM (Pulse Width Modulation) signals for motor control or LED brightness adjustment</p></li>
</ul>
<section id="timer-modes">
<h3><span class="section-number">4.1.6.6.1.1. </span>Timer Modes<a class="headerlink" href="#timer-modes" title="Link to this heading"></a></h3>
<ul class="simple">
<li><p>Input Capture: Measures signal properties like frequency or pulse width.</p></li>
<li><p>Output Compare: Generates output signals at specific intervals.</p></li>
<li><p>PWM Mode: Generates PWM signals with adjustable frequency and duty cycle.</p></li>
</ul>
</section>
</section>
<section id="key-configurations-for-pwm-signal-generation">
<h2><span class="section-number">4.1.6.6.2. </span>Key Configurations for PWM Signal Generation<a class="headerlink" href="#key-configurations-for-pwm-signal-generation" title="Link to this heading"></a></h2>
<ol class="arabic">
<li><p><strong>Prescaler</strong>
- The prescaler divides the timer’s clock frequency to reduce it and ensure the PWM signal period falls within a valid range (0–65535 for a 16-bit timer).
- Formula:</p>
<blockquote>
<div><div class="math notranslate nohighlight">
\[Prescaler = \frac{Timer\ Frequency}{Desired\ Frequency \times Max\ ARR}\]</div>
</div></blockquote>
<ul class="simple">
<li><p>If the calculated period exceeds 65535, the prescaler must be increased to reduce the period and fit it within the 16-bit range.</p></li>
</ul>
</li>
<li><p><strong>Auto-Reload Register (ARR)</strong>
- ARR defines the period of the PWM signal and is calculated after setting the prescaler.
- Formula:</p>
<blockquote>
<div><div class="math notranslate nohighlight">
\[ARR = \left[ \frac{Timer\ Frequency}{Prescaler \times Desired\ Frequency} \right] - 1\]</div>
</div></blockquote>
<ul class="simple">
<li><p>The ARR value directly determines the timer’s maximum count value and ensures the PWM signal’s accurate period.</p></li>
</ul>
</li>
<li><p><strong>Compare Register (CCR)</strong></p>
<ul class="simple">
<li><p>Determines the duty cycle by specifying how long the signal stays high within one period.</p></li>
</ul>
</li>
<li><p><strong>Control Registers</strong></p>
<ul class="simple">
<li><p>TIM_CR1: Enables the timer and configures basic settings.</p></li>
<li><p>TIM_CCER: Enables the output compare channel.</p></li>
<li><p>TIM_CCMR: Configures PWM mode.</p></li>
</ul>
</li>
</ol>
</section>
<section id="practical-example-configuring-pwm-on-timer-2">
<h2><span class="section-number">4.1.6.6.3. </span>Practical Example: Configuring PWM on Timer 2<a class="headerlink" href="#practical-example-configuring-pwm-on-timer-2" title="Link to this heading"></a></h2>
<p>Configure Timer 2 to generate a PWM signal with a frequency of 1 kHz and a 50% duty cycle, assuming the system clock is 16 MHz.</p>
<ol class="arabic">
<li><p>Calculate the Prescaler:</p>
<ul>
<li><p>Using the formula:</p>
<div class="math notranslate nohighlight">
\[Prescaler = \frac{Timer\ Frequency}{Desired\ Frequency \times Max\ ARR}\]</div>
</li>
<li><p>Assume Max ARR = 65535 and Desired Frequency = 1000 Hz:</p>
<div class="math notranslate nohighlight">
\[Prescaler = \frac{16000000}{1000 \times 65535} \approx 2.44\]</div>
</li>
<li><p>Choose Prescaler = 3 (rounding up ensures the frequency fits within the timer range).</p></li>
</ul>
</li>
<li><p>Calculate the ARR Value:</p>
<ul>
<li><p>Using the formula:</p>
<div class="math notranslate nohighlight">
\[ARR = \left[ \frac{Timer\ Frequency}{Prescaler \times Desired\ Frequency} \right] - 1\]</div>
</li>
<li><p>Substituting values:</p>
<div class="math notranslate nohighlight">
\[ARR = \left[ \frac{16000000}{3 \times 1000} \right] - 1 = 5332\]</div>
</li>
</ul>
</li>
<li><p>Timer Configuration in Code:</p>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="n">RCC</span><span class="o">-&gt;</span><span class="n">APB1ENR</span><span class="w"> </span><span class="o">|=</span><span class="w"> </span><span class="n">RCC_APB1ENR_TIM2EN</span><span class="p">;</span><span class="w">  </span><span class="c1">// Enable TIM2 clock</span>

<span class="n">TIM2</span><span class="o">-&gt;</span><span class="n">PSC</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">3</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="mi">1</span><span class="p">;</span><span class="w">                   </span><span class="c1">// Set prescaler to 3 (subtract 1 for zero-based indexing)</span>
<span class="n">TIM2</span><span class="o">-&gt;</span><span class="n">ARR</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">5332</span><span class="p">;</span><span class="w">                    </span><span class="c1">// Set ARR for a 1 kHz frequency</span>
<span class="n">TIM2</span><span class="o">-&gt;</span><span class="n">CCR1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">2666</span><span class="p">;</span><span class="w">                   </span><span class="c1">// Set CCR1 for 50% duty cycle (ARR / 2)</span>

<span class="n">TIM2</span><span class="o">-&gt;</span><span class="n">CCMR1</span><span class="w"> </span><span class="o">|=</span><span class="w"> </span><span class="p">(</span><span class="mi">6</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">TIM_CCMR1_OC1M_Pos</span><span class="p">);</span><span class="w">  </span><span class="c1">// PWM mode 1</span>
<span class="n">TIM2</span><span class="o">-&gt;</span><span class="n">CCER</span><span class="w"> </span><span class="o">|=</span><span class="w"> </span><span class="n">TIM_CCER_CC1E</span><span class="p">;</span><span class="w">               </span><span class="c1">// Enable output for channel 1</span>

<span class="n">TIM2</span><span class="o">-&gt;</span><span class="n">CR1</span><span class="w"> </span><span class="o">|=</span><span class="w"> </span><span class="n">TIM_CR1_CEN</span><span class="p">;</span><span class="w">            </span><span class="c1">// Enable the timer</span>
</pre></div>
</div>
</li>
</ol>
</section>
<section id="summary">
<h2><span class="section-number">4.1.6.6.4. </span>Summary<a class="headerlink" href="#summary" title="Link to this heading"></a></h2>
<p>Timers in STM32F411 are highly configurable and essential for generating PWM signals. The prescaler and ARR values ensure the timer operates within its hardware limits, while CCR adjusts the duty cycle.</p>
</section>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="USART.html" class="btn btn-neutral float-left" title="4.1.6.5. USART on STM32F411" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="../semin-murtic/lessons.html" class="btn btn-neutral float-right" title="4.1.7. Lessons by Semin Murtić" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2024, Maasu BH d.o.o..</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>