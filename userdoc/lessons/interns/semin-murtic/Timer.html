<!DOCTYPE html>
<html class="writer-html5" lang="en" data-content_root="../../../../">
<head>
  <meta charset="utf-8" /><meta name="viewport" content="width=device-width, initial-scale=1" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>4.1.6.6. Timer &mdash; Maasu Internship 4 1 documentation</title>
      <link rel="stylesheet" type="text/css" href="../../../../_static/pygments.css?v=80d5e7a1" />
      <link rel="stylesheet" type="text/css" href="../../../../_static/css/theme.css?v=19f00094" />
      <link rel="stylesheet" type="text/css" href="../../../../_static/sphinx-data-viewer/jsonview.bundle.css?v=f6ef2277" />
      <link rel="stylesheet" type="text/css" href="../../../../_static/sphinx-needs/libs/html/datatables.min.css?v=4b4fd840" />
      <link rel="stylesheet" type="text/css" href="../../../../_static/sphinx-needs/common.css?v=bd9ab754" />
      <link rel="stylesheet" type="text/css" href="../../../../_static/sphinx-needs/layouts.css?v=448c382f" />
      <link rel="stylesheet" type="text/css" href="../../../../_static/sphinx-needs/styles.css?v=6c8eb985" />
      <link rel="stylesheet" type="text/css" href="../../../../_static/sphinx-needs/modern.css?v=ffa536d2" />

  
  <!--[if lt IE 9]>
    <script src="../../../../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script src="../../../../_static/jquery.js?v=5d32c60e"></script>
        <script src="../../../../_static/_sphinx_javascript_frameworks_compat.js?v=2cd50e6c"></script>
        <script src="../../../../_static/documentation_options.js?v=29a6c3e3"></script>
        <script src="../../../../_static/doctools.js?v=888ff710"></script>
        <script src="../../../../_static/sphinx_highlight.js?v=dc90522c"></script>
        <script src="../../../../_static/sphinx-data-viewer/jsonview.bundle.js?v=18cd53c5"></script>
        <script src="../../../../_static/sphinx-data-viewer/jsonview_loader.js?v=f7ff7e7d"></script>
        <script src="../../../../_static/sphinx-needs/libs/html/datatables.min.js?v=8a4aee21"></script>
        <script src="../../../../_static/sphinx-needs/libs/html/datatables_loader.js?v=a2cae175"></script>
        <script src="../../../../_static/sphinx-needs/libs/html/sphinx_needs_collapse.js?v=f783d6a5"></script>
    <script src="../../../../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../../../../genindex.html" />
    <link rel="search" title="Search" href="../../../../search.html" />
    <link rel="next" title="4.1.7. Lessons by Tarik Sinanović" href="../tarik-sinanovic/lessons.html" />
    <link rel="prev" title="4.1.6.5. USART" href="USART.html" />
<link href="../../../../_static/style.css" rel="stylesheet" type="text/css">

</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="../../../../index.html" class="icon icon-home">
            Maasu Internship 4
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">Contents:</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../../../introduction/introduction.html">1. Introduction</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../fundamentals/fundamentals.html">2. Fundamentals</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../environment_setup/environment_setup.html">3. Development Environment Setup</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="../../lessons.html">4. Lessons</a><ul class="current">
<li class="toctree-l2 current"><a class="reference internal" href="../lessons.html">4.1. Lessons written by each intern</a><ul class="current">
<li class="toctree-l3"><a class="reference internal" href="../adna-njuhovic/lessons.html">4.1.1. Lessons by Adna Njuhović</a></li>
<li class="toctree-l3"><a class="reference internal" href="../demir-hasicic/lessons.html">4.1.2. Lessons by Demir Hasičić</a></li>
<li class="toctree-l3"><a class="reference internal" href="../emina-mesic/lessons.html">4.1.3. Lessons by Emina Mešić</a></li>
<li class="toctree-l3"><a class="reference internal" href="../lamija-fatic/lessons.html">4.1.4. Lessons by Lamija Fatić</a></li>
<li class="toctree-l3"><a class="reference internal" href="../muhibija-kavazovic/lessons.html">4.1.5. Lessons by Muhibija Kavazović</a></li>
<li class="toctree-l3 current"><a class="reference internal" href="lessons.html">4.1.6. Lessons by Semin Murtić</a><ul class="current">
<li class="toctree-l4"><a class="reference internal" href="V-Model.html">4.1.6.1. V-Model</a></li>
<li class="toctree-l4"><a class="reference internal" href="STM32F411.html">4.1.6.2. STM32F411</a></li>
<li class="toctree-l4"><a class="reference internal" href="GPIO.html">4.1.6.3. GPIO</a></li>
<li class="toctree-l4"><a class="reference internal" href="Clock.html">4.1.6.4. Clock</a></li>
<li class="toctree-l4"><a class="reference internal" href="USART.html">4.1.6.5. USART</a></li>
<li class="toctree-l4 current"><a class="current reference internal" href="#">4.1.6.6. Timer</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../tarik-sinanovic/lessons.html">4.1.7. Lessons by Tarik Sinanović</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../../requirements/requirements.html">5. Requirements</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../faqs/faqs.html">6. Frequently Asked Questions</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../glossary/glossary.html">7. Glossary</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../resources/resources.html">8. Resources</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../../../index.html">Maasu Internship 4</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../../../../index.html" class="icon icon-home" aria-label="Home"></a></li>
          <li class="breadcrumb-item"><a href="../../lessons.html"><span class="section-number">4. </span>Lessons</a></li>
          <li class="breadcrumb-item"><a href="../lessons.html"><span class="section-number">4.1. </span>Lessons written by each intern</a></li>
          <li class="breadcrumb-item"><a href="lessons.html"><span class="section-number">4.1.6. </span>Lessons by Semin Murtić</a></li>
      <li class="breadcrumb-item active"><span class="section-number">4.1.6.6. </span>Timer</li>
      <li class="wy-breadcrumbs-aside">
            <a href="../../../../_sources/userdoc/lessons/interns/semin-murtic/Timer.rst.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="timer">
<span id="id1"></span><h1><span class="section-number">4.1.6.6. </span>Timer<a class="headerlink" href="#timer" title="Link to this heading"></a></h1>
<section id="overview">
<h2><span class="section-number">4.1.6.6.1. </span>Overview<a class="headerlink" href="#overview" title="Link to this heading"></a></h2>
<p>Timers on the STM32F411 microcontroller are used for various purposes, including measuring time, generating precise time intervals, creating signals, and managing time-dependent processes. The STM32F411 has several timers (e.g., TIM1, TIM2, TIM3, etc.) that can be used for different tasks such as generating PWM signals, triggering interrupts based on time intervals, and more.</p>
</section>
<section id="timer-functionalities">
<h2><span class="section-number">4.1.6.6.2. </span>Timer Functionalities<a class="headerlink" href="#timer-functionalities" title="Link to this heading"></a></h2>
<ol class="arabic simple">
<li><p><strong>Time Measurement:</strong>
Timers are used to count time intervals. The STM32F411 timer can use either the system clock or an external signal to trigger the counter, which can then generate time-based interrupts or execute processes based on time.</p></li>
<li><p><strong>Pulse Generation:</strong>
Timers can generate precise pulses with defined periods and frequencies, often used for applications like PWM.</p></li>
<li><p><strong>Interrupts:</strong>
Timers allow generating interrupts when the counter reaches a predefined value.</p></li>
</ol>
</section>
<section id="timer-use-cases">
<h2><span class="section-number">4.1.6.6.3. </span>Timer Use Cases<a class="headerlink" href="#timer-use-cases" title="Link to this heading"></a></h2>
<ul class="simple">
<li><p><strong>Generating Accurate Time Intervals:</strong>
Timers can be used for creating delays or controlling the execution speed of programs. They provide precise time intervals for various tasks.</p></li>
<li><p><strong>Managing Time-Dependent Processes:</strong>
For example, a timer can trigger specific functions at regular time intervals, such as activating an event every few milliseconds.</p></li>
</ul>
</section>
<section id="pwm-pulse-width-modulation">
<h2><span class="section-number">4.1.6.6.4. </span>PWM (Pulse Width Modulation)<a class="headerlink" href="#pwm-pulse-width-modulation" title="Link to this heading"></a></h2>
<p>PWM is a technique used to generate variable output signals with different duty cycles (the percentage of time the signal is high). On STM32F411, PWM can be generated using timers, which control output signals on GPIO pins.</p>
</section>
<section id="key-pwm-parameters">
<h2><span class="section-number">4.1.6.6.5. </span>Key PWM Parameters<a class="headerlink" href="#key-pwm-parameters" title="Link to this heading"></a></h2>
<ul class="simple">
<li><p><strong>Duty Cycle:</strong>
The duty cycle of a PWM signal represents the percentage of time the signal is high (active) within one period. For example, a 50% duty cycle means the signal is high for 50% of the time and low for the other 50%.</p></li>
<li><p><strong>Frequency:</strong>
The frequency of the PWM signal determines how many times per second the signal transitions between high and low states. On STM32F411, the frequency is determined by the timer’s period.</p></li>
</ul>
</section>
<section id="pwm-applications">
<h2><span class="section-number">4.1.6.6.6. </span>PWM Applications<a class="headerlink" href="#pwm-applications" title="Link to this heading"></a></h2>
<ul class="simple">
<li><p><strong>Motor Speed Control:</strong>
PWM signals can be used to control the speed of DC motors. Increasing the duty cycle increases the motor’s speed, while decreasing it slows the motor down.</p></li>
<li><p><strong>LED Brightness Control:</strong>
PWM is used to control the brightness of LEDs. Increasing the duty cycle makes the LED brighter, and decreasing it makes the LED dimmer.</p></li>
<li><p><strong>Sound Generation:</strong>
PWM can be used to generate sound signals of different frequencies and tones.</p></li>
<li><p><strong>Servo Motor Control:</strong>
PWM can also be used to regulate the position of a servo motor by varying the duty cycle.</p></li>
</ul>
</section>
<section id="pwm-initialization-process">
<h2><span class="section-number">4.1.6.6.7. </span>PWM Initialization Process<a class="headerlink" href="#pwm-initialization-process" title="Link to this heading"></a></h2>
<ol class="arabic simple">
<li><p><strong>Enable the Timer Clock:</strong>
Enable the clock for the appropriate timer to ensure it functions correctly. Each timer has a corresponding bit in the RCC (Reset and Clock Control) register, which must be set to activate the timer.
Example: For TIM1, set <cite>RCC_APB2ENR_TIM1EN</cite>, and for TIM2, set <cite>RCC_APB1ENR_TIM2EN</cite>.</p></li>
<li><p><strong>Configure GPIO Pins:</strong>
Select the appropriate GPIO pins for the timer’s function and enable the alternate functions (AF) for those pins. Refer to the datasheet for detailed pin mappings and alternate functions.</p></li>
<li><p><strong>Set Frequency and Duty Cycle:</strong>
To set the frequency, adjust the <strong>Prescaler</strong> and <strong>ARR</strong> (Auto-Reload Register). The <strong>Prescaler</strong> divides the timer clock, and the <strong>ARR</strong> defines the period of the PWM signal. The duty cycle is set by adjusting the <strong>CCR</strong> (Capture/Compare Register), which controls how long the signal stays high during each period.</p></li>
<li><p><strong>Enable PWM Mode:</strong>
Enable the output compare mode and configure the timer’s channels for PWM output. This is done through the <strong>CCMR</strong> (Capture/Compare Mode Register) and <strong>CCER</strong> (Capture/Compare Enable Register).</p></li>
</ol>
</section>
<section id="timer-frequency-and-prescaler-calculation">
<h2><span class="section-number">4.1.6.6.8. </span>Timer Frequency and Prescaler Calculation<a class="headerlink" href="#timer-frequency-and-prescaler-calculation" title="Link to this heading"></a></h2>
<ol class="arabic">
<li><p><strong>Determine Timer Frequency:</strong>
STM32F411 timers on different APBs (APB1 or APB2) run at different clock frequencies:
- Timers on APB1 (e.g., TIM2, TIM3, TIM4, TIM5) run at 50 MHz.
- Timers on APB2 (e.g., TIM1, TIM9, TIM10, TIM11) run at 100 MHz.</p></li>
<li><p><strong>Calculate Timer Period and PWM Frequency:</strong>
To set the desired PWM frequency, the timer’s period is calculated by dividing the timer’s clock frequency by the desired PWM frequency:
- <cite>Period = Timer Frequency / Desired PWM Frequency</cite></p>
<p>Example: If you want a PWM frequency of 1 kHz using a 50 MHz timer:
- <cite>Period = 50,000,000 / 1,000 = 50,000</cite></p>
</li>
<li><p><strong>Set Prescaler and ARR:</strong>
- The prescaler divides the timer frequency to ensure the period fits within the valid range of the timer’s ARR (Auto-Reload Register). If the calculated period exceeds the timer’s maximum value (65535 for a 16-bit timer), the prescaler is adjusted.
- <cite>Prescaler = Timer Frequency / (Desired Frequency * Max ARR)</cite>
- <cite>ARR = [(Timer Frequency) / (Desired Frequency * Prescaler)] - 1</cite></p></li>
<li><p><strong>Write Values to Registers:</strong>
- <strong>Prescaler Register (PSC):</strong> Set the prescaler value.
- <strong>ARR Register:</strong> Set the calculated period value.</p></li>
</ol>
</section>
<section id="duty-cycle-calculation">
<h2><span class="section-number">4.1.6.6.9. </span>Duty Cycle Calculation<a class="headerlink" href="#duty-cycle-calculation" title="Link to this heading"></a></h2>
<p>The duty cycle defines how long the signal stays high in each period. For instance, a 25% duty cycle means the signal is high for 25% of the period.</p>
<ol class="arabic">
<li><p><strong>Duty Cycle Calculation:</strong>
The <strong>CCR</strong> (Capture/Compare Register) value that defines the duty cycle is calculated as:
- <cite>CCR = (Duty Cycle * (ARR + 1)) / 100</cite></p>
<p>Example: For a 25% duty cycle and an ARR value of 2500:
- <cite>CCR = (25 * (2500 + 1)) / 100 = 625</cite></p>
</li>
<li><p><strong>Set CCR:</strong>
Write the calculated <strong>CCR</strong> value to the appropriate <strong>CCR</strong> register (e.g., CCR1, CCR2, etc.).</p></li>
</ol>
</section>
<section id="center-aligned-vs-edge-aligned-mode">
<h2><span class="section-number">4.1.6.6.10. </span>Center-Aligned vs. Edge-Aligned Mode<a class="headerlink" href="#center-aligned-vs-edge-aligned-mode" title="Link to this heading"></a></h2>
<ol class="arabic simple">
<li><p><strong>Center-Aligned Mode:</strong>
In this mode, the timer counts both upwards and downwards within the PWM period, generating a symmetric signal.</p></li>
<li><p><strong>Edge-Aligned Mode:</strong>
In this mode, the timer counts from 0 to ARR, and when it reaches ARR, it resets, producing a signal with transitions at the edges of the period. This is the default mode for PWM generation.</p></li>
</ol>
</section>
<section id="example-generating-a-20-khz-pwm-with-a-25-duty-cycle-on-tim3">
<h2><span class="section-number">4.1.6.6.11. </span>Example: Generating a 20 kHz PWM with a 25% Duty Cycle on TIM3<a class="headerlink" href="#example-generating-a-20-khz-pwm-with-a-25-duty-cycle-on-tim3" title="Link to this heading"></a></h2>
<ol class="arabic simple">
<li><p><strong>Enable Clock:</strong> Set <cite>RCC_APB1ENR_TIM3EN</cite> to enable the clock for TIM3 (50 MHz).</p></li>
<li><p><strong>Configure GPIO Pins:</strong> Set the alternate function for PB0 to AF2 (for TIM3).</p></li>
<li><p><strong>Set PWM Mode:</strong> Clear the appropriate bits in the <strong>CCMR2</strong> register for channel 3. Enable <strong>OC3PE</strong> for stable PWM operation.</p></li>
<li><p><strong>Set Frequency:</strong>
- <cite>Period = 50,000,000 / 20,000 = 2500</cite>
- <cite>Prescaler = 0</cite> (since the period is within the 16-bit range).
- <cite>ARR = 2500 - 1 = 2499</cite></p></li>
<li><p><strong>Calculate Duty Cycle:</strong>
- <cite>CCR = (25 * (2499 + 1)) / 100 = 625</cite>
Write 625 to <strong>CCR3</strong>.</p></li>
<li><p><strong>Enable PWM:</strong> Set <cite>TIM_CR1_CEN</cite> to start the timer and enable PWM output.</p></li>
</ol>
</section>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="USART.html" class="btn btn-neutral float-left" title="4.1.6.5. USART" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="../tarik-sinanovic/lessons.html" class="btn btn-neutral float-right" title="4.1.7. Lessons by Tarik Sinanović" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2024, Maasu BH d.o.o..</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>